# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A Flutter application for grape management with video recording/playback capabilities. Uses Firebase Firestore for data storage and Firebase Storage for video files.

## Development Commands

### Code Generation
The project heavily relies on code generation for Riverpod providers, Freezed data classes, and JSON serialization:

```bash
# Generate all code (required after adding/modifying providers or models)
flutter packages pub run build_runner build

# Watch mode for continuous generation during development
flutter packages pub run build_runner watch

# Clean and rebuild when encountering conflicts
flutter packages pub run build_runner clean
flutter packages pub run build_runner build --delete-conflicting-outputs
```

### Build & Run
```bash
# Standard Flutter development
flutter run

# Release builds
flutter build apk --release
flutter build ios --release
```

### Testing
```bash
flutter test
```

## Architecture Overview

### Clean Architecture with Feature-First Organization

- **Domain Layer** (`lib/domain/`): Core business entities using Freezed for immutable data classes
- **Features Layer** (`lib/features/`): Feature modules (app, auth, grape, qr, video) with pages and components
- **Repository Layer** (`lib/repositories/`): Data access abstraction over Firebase Firestore
- **Providers** (`lib/providers/`): Riverpod providers for dependency injection

### State Management: Riverpod 2.x with Code Generation

All state management uses Riverpod with code generation. Key patterns:
- `@riverpod` annotation for functional providers
- `@Riverpod(keepAlive: true)` for singleton providers  
- AsyncNotifier classes for complex state management
- Generated files have `.g.dart` suffix

### Navigation: GoRouter

Declarative routing with these main routes:
- `/` - Entrance page
- `/grapes` - Grape list with infinite scroll
- `/grape-details/:grapeId` - Grape details
- `/take-video/:grapeId` - Video recording
- `/watch-video/:grapeId` - Video playback
- `/create-qr` and `/scan-qr` - QR code functionality

### Data Layer: Firebase Integration

- **Firestore**: Main database with type-safe document converters
- **Storage**: Video file storage
- **Repository Pattern**: `GrapeRepo` handles all grape-related data operations with cursor-based pagination

## Key Implementation Patterns

### Adding New Features

1. Create feature directory under `lib/features/[feature_name]/`
2. Add pages in `pages/` subdirectory
3. Create state management with Riverpod providers
4. Run code generation: `flutter packages pub run build_runner build`
5. Add routes to `lib/rooting/router.dart`

### Working with Providers

All providers use code generation. When creating new providers:
- Use `@riverpod` annotation
- Import `package:riverpod_annotation/riverpod_annotation.dart`
- Add `part '[filename].g.dart';` directive
- Run build_runner after changes

### Data Models

All data models use Freezed for immutability:
- Use `@freezed` annotation
- Include `fromJson`/`toJson` with `@JsonSerializable()`
- Import required packages and add part files
- Run build_runner after changes

### Video Functionality

Video features are centralized in `lib/features/video/`:
- `VideoPlayerWidget`: Reusable video player component
- Custom progress indicators and floating action buttons
- Proper lifecycle management with provider cleanup

## Firebase Configuration

- Development uses Flutter version 3.19.1 (managed via FVM)
- Firebase configuration files are already set up for iOS/Android
- Video files are stored in Firebase Storage with URLs stored in Firestore documents

## Code Generation Files

Never edit these files directly (they'll be overwritten):
- `*.g.dart` - Generated by json_serializable and riverpod_generator
- `*.freezed.dart` - Generated by freezed
- `router.g.dart` - Generated by go_router

## Linting & Code Quality

The project uses strict linting rules defined in `analysis_options.yaml`. Always run `dart fix --apply` to auto-fix issues before committing.

## User Experience Guidelines

### Audio Feedback

After completing any significant process or action (such as video recording, data saving, QR code scanning, etc.), provide audio feedback to the user by playing a notification sound. This improves user experience by providing clear confirmation that the action has been completed successfully.